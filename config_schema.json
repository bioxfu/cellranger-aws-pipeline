{
  "type": "object",
  "properties": {
    "experiment": {
      "type": "object",
      "properties": {
        "bcl2fastq_version": { "type": "string" },
        "cellranger_version": { "type": "string" },
        "himc_pool": { "type": "string" },
        "run": { "type": "string" },
        "sequencing_data": {
          "type": "string",
          "format": "date"
        }
      },
      "required": [
        "bcl2fastq_version",
        "cellranger_version",
        "himc_pool",
        "run",
        "sequencing_date"
      ],
      "additional_properties": false
    },
    "processing": {
      "type": "object",
      "properties": {
        "mkfastq": {
          "type": "object",
          "properties": {
            "samples": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "index_location": { "type": "string" }
                },
                "required": [ "name", "index_location" ]
              }
            }
          },
          "required": [ "samples" ],
          "additional_properties": false
        }
      }
    },
    "analyses": {
      "type": "object",
      "additional_properties": false,
      "properties": {
        "samples": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "job_type": {
                "type": "string",
                "enum": [ "count", "vdj" ]
              },
              "chemistry": { "type": "string" },
              "reference_transcriptome": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "version": { "type": "string" }
                },
                "required": [ "name", "version" ]
              },
              "target_cell_count": { "type": "number" },
              "feature_barcoding": { "type": "boolean" },
              "pooled_run": { "type": "boolean" }
            },
            "required": [
              "name",
              "job_type",
              "reference_transcriptome",
              "feature_barcoding",
              "pooled_run"
            ],
            "anyOf": [
              {
                "description": "if job_type is not count, then don't add additional requirements",
                "not": {
                  "properties": {
                    "job_type": { "enum": ["count"] }
                  }
                }
              },
              {
                "required": ["target_cell_count"]
              }
            ],
            "additional_properties": false
          }
        }
      }
    }
  }
}
